# Incident Response Playbook

This playbook outlines the steps administrators should follow when investigating and remediating security incidents within the TM Project platform.

## 1. Preparation
- Ensure the `.env` file contains valid values for `MFA_ENCRYPTION_KEY` and `SECURITY_ALERT_EMAIL` so that MFA secrets remain encrypted and security alerts are delivered.
- Confirm administrators have access to the `/api/admin/audit/logs` and `/api/admin/sessions` endpoints for visibility into user activity.
- Review monitoring alerts emitted by `MonitoringService` and configure log shipping to your SIEM of choice.

## 2. Identification
1. Review high-risk security notifications generated by the system (e.g., impossible travel, suspicious login patterns).
2. Examine `SecurityEvent` entries and admin audit logs for the affected user IDs.
3. Correlate device fingerprints, IP addresses, and geo-location metadata stored with refresh sessions.

## 3. Containment
- Use the admin session management endpoints to revoke a suspicious session (`DELETE /api/admin/sessions/:sessionId`) or to mass-logout a user (`POST /api/admin/sessions/:userId/revoke-all`).
- Enforce MFA on accounts that repeatedly trigger alerts by toggling the `mfa.enforced` flag in the user profile.
- If credentials are suspected to be compromised, reset passwords using the password policy enforcement already in place.

## 4. Eradication
- Investigate source IPs and device fingerprints to identify the root cause.
- Remove malicious API keys, OAuth applications, or third-party integrations associated with the incident.
- Patch vulnerable code paths and deploy fixes.

## 5. Recovery
- Monitor for re-occurrence via `SecurityEvent` logs and monitoring alerts.
- Notify impacted users once remediation steps are complete.
- Document all actions in the admin audit log for future reference.

## 6. Lessons Learned
- Conduct a post-incident review with engineering and operations stakeholders.
- Update runbooks, detection rules, and alert thresholds based on findings.
- Schedule periodic tabletop exercises to keep the response team proficient.

Keep this document version-controlled and update it whenever new controls or workflows are introduced.
