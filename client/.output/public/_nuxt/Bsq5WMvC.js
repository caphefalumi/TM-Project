import{s as p}from"./DEKGnF_z.js";import{_ as S,x as g}from"./B4Kh-yHs.js";import{Q as c,V as l,J as e,S as y,_ as f,F as w,am as A,I as d,a0 as u,ah as v,L as C,af as b}from"./CGnq_Kza.js";import"./CjwIl2eS.js";class ${constructor(){this.warnings=new Set,this.isMonitoring=!1,this.monitoringInterval=null}async getActiveSessions(){try{const t=await fetch("undefined/api/sessions/active",{method:"GET",credentials:"include"});return t.ok?{success:!0,...await t.json()}:{success:!1,error:t.statusText}}catch(t){return{success:!1,error:t.message}}}async checkSecurity(){try{const t=await fetch("undefined/api/sessions/security",{method:"GET",credentials:"include"});if(t.ok){const o=await t.json();return o.isSuspicious&&this.warnings.add("suspicious_activity"),o.uniqueIPs>3&&this.warnings.add("multiple_locations"),{success:!0,...o}}else return{success:!1,error:t.statusText}}catch(t){return{success:!1,error:t.message}}}async revokeSession(s){try{const o=await fetch(`undefined/api/sessions/${s}`,{method:"DELETE",credentials:"include"});return o.ok?{success:!0,message:(await o.json()).message}:{success:!1,error:o.statusText}}catch(o){return{success:!1,error:o.message}}}async revokeAllOtherSessions(){try{const t=await fetch("undefined/api/sessions/others/all",{method:"DELETE",credentials:"include"});if(t.ok){const o=await t.json();return this.clearWarnings(),{success:!0,message:o.message,count:o.count}}else return{success:!1,error:t.statusText}}catch(t){return{success:!1,error:t.message}}}formatSessionInfo(s){if(!s)return{};const t=o=>{const i=new Date,a=new Date(o),r=i-a,m=Math.floor(r/6e4);if(m<1)return"Just now";if(m<60)return`${m} min ago`;const _=Math.floor(m/60);return _<24?`${_}h ago`:`${Math.floor(_/24)}d ago`};return{...s,lastActivityFormatted:t(s.lastActivity),createdAtFormatted:t(s.createdAt),isCurrentSession:!0}}formatIpAddress(s){return s?s.includes("127.0.0.1")||s.includes("::1")||s.includes("localhost")?"Local Development":s.startsWith("192.168.")||s.startsWith("10.")||s.startsWith("172.")?"Private Network":`IP: ${s}`:"Unknown Location"}startActivityMonitoring(){this.isMonitoring||(this.isMonitoring=!0,this.monitoringInterval=p(async()=>{await this.checkSecurity()},300*1e3))}stopActivityMonitoring(){this.monitoringInterval&&(clearInterval(this.monitoringInterval),this.monitoringInterval=null),this.isMonitoring=!1}clearWarnings(){this.warnings.clear()}hasWarnings(){return this.warnings.size>0}getWarnings(){return Array.from(this.warnings)}checkSecurityHeaders(s){return!0}}const h=new $,I={name:"SessionManager",data(){return{sessions:[],loading:!0,revoking:!1,currentSessionId:null}},async mounted(){await this.loadSessions()},methods:{async loadSessions(){this.loading=!0;try{const n=await h.getActiveSessions();if(n.success){this.sessions=n.tokens.map(t=>({id:t.id,ipAddress:t.ipAddress,location:t.location,browser:t.browser,device:t.device,lastActivity:t.lastActivity,activityCount:t.activityCount,createdAt:t.createdAt,isCurrent:t.isCurrent||!1}));const s=this.sessions.find(t=>t.isCurrent);s&&(this.currentSessionId=s.id),this.sessions.sort((t,o)=>t.isCurrent?-1:o.isCurrent?1:new Date(o.lastActivity)-new Date(t.lastActivity))}}catch{}finally{this.loading=!1}},async revokeSession(n){if(n!==this.currentSessionId){this.revoking=!0;try{(await h.revokeSession(n)).success?(this.sessions=this.sessions.filter(t=>t.id!==n),this.$emit("session-revoked",{sessionId:n}),this.$emit("show-message","Session ended successfully","success")):this.$emit("show-message","Failed to end session","error")}catch{this.$emit("show-message","Error ending session","error")}finally{this.revoking=!1}}},async revokeAllOtherSessions(){this.revoking=!0;try{if((await h.revokeAllOtherSessions()).success){const s=this.sessions.filter(t=>!t.isCurrent).length;this.sessions=this.sessions.filter(t=>t.isCurrent),this.$emit("sessions-revoked",{count:s}),this.$emit("show-message",`${s} sessions ended successfully`,"success")}else this.$emit("show-message","Failed to end sessions","error")}catch{this.$emit("show-message","Error ending sessions","error")}finally{this.revoking=!1}},getDeviceIcon(n){const s=n.toLowerCase();return s.includes("mobile")||s.includes("phone")?"mdi-cellphone":s.includes("tablet")||s.includes("ipad")?"mdi-tablet":"mdi-monitor"},formatLastActivity(n){const s=new Date,t=new Date(n),o=s-t,i=Math.floor(o/6e4);if(i<1)return"just now";if(i<60)return`${i} min ago`;const a=Math.floor(i/60);return a<24?`${a}h ago`:`${Math.floor(a/24)}d ago`},formatIpAddress(n){return h.formatIpAddress(n)},formatLocation(n){return!n||n==="Unknown, Unknown"||n===", "?"Unknown Location":n==="Local, Local"?"Local Network":n}}},L={class:"session-manager"},M={class:"section-header"},E={class:"session-count"},T={key:0,class:"loading"},D={key:1,class:"no-sessions"},P={key:2,class:"sessions-list"},x={class:"session-info"},O={class:"session-header"},R={class:"device-info"},F={class:"device-name"},q={key:0,class:"current-badge"},N={class:"session-actions"},U=["onClick","disabled"],V={class:"session-details"},W={class:"detail-item"},j={class:"detail-item"},B={class:"detail-item"},H={class:"detail-item"},z={key:3,class:"bulk-actions"},G=["disabled"],J={key:4,class:"loading-overlay"};function Q(n,s,t,o,i,a){return l(),c("div",L,[e("div",M,[s[1]||(s[1]=e("h3",null,"Active Sessions",-1)),e("span",E,f(i.sessions.length)+" active",1)]),i.loading?(l(),c("div",T,[...s[2]||(s[2]=[e("p",null,"Loading sessions...",-1)])])):i.sessions.length===0?(l(),c("div",D,[...s[3]||(s[3]=[e("p",null,"No active sessions found",-1)])])):(l(),c("div",P,[(l(!0),c(w,null,A(i.sessions,r=>(l(),c("div",{key:r.id,class:C(["session-item",{"current-session":r.isCurrent}])},[e("div",x,[e("div",O,[e("div",R,[d(g,{class:"device-icon"},{default:v(()=>[u(f(a.getDeviceIcon(r.device)),1)]),_:2},1024),e("span",F,f(r.browser),1),r.isCurrent?(l(),c("span",q,"Current")):y("",!0)]),e("div",N,[r.isCurrent?y("",!0):(l(),c("button",{key:0,onClick:m=>a.revokeSession(r.id),class:"btn-revoke",disabled:i.revoking},[d(g,null,{default:v(()=>[...s[4]||(s[4]=[u("mdi-close",-1)])]),_:1}),s[5]||(s[5]=u(" End ",-1))],8,U))])]),e("div",V,[e("div",W,[d(g,{class:"detail-icon"},{default:v(()=>[...s[6]||(s[6]=[u("mdi-web",-1)])]),_:1}),e("span",null,f(a.formatIpAddress(r.ipAddress)),1)]),e("div",j,[d(g,{class:"detail-icon"},{default:v(()=>[...s[7]||(s[7]=[u("mdi-map-marker",-1)])]),_:1}),e("span",null,f(a.formatLocation(r.location)),1)]),e("div",B,[d(g,{class:"detail-icon"},{default:v(()=>[...s[8]||(s[8]=[u("mdi-clock",-1)])]),_:1}),e("span",null,"Last active "+f(a.formatLastActivity(r.lastActivity)),1)]),e("div",H,[d(g,{class:"detail-icon"},{default:v(()=>[...s[9]||(s[9]=[u("mdi-counter",-1)])]),_:1}),e("span",null,f(r.activityCount)+" activities",1)])])])],2))),128))])),i.sessions.length>1?(l(),c("div",z,[e("button",{onClick:s[0]||(s[0]=(...r)=>a.revokeAllOtherSessions&&a.revokeAllOtherSessions(...r)),class:"btn-danger",disabled:i.revoking},[d(g,null,{default:v(()=>[...s[10]||(s[10]=[u("mdi-logout-variant",-1)])]),_:1}),s[11]||(s[11]=u(" End All Other Sessions ",-1))],8,G)])):y("",!0),i.revoking?(l(),c("div",J,[...s[12]||(s[12]=[e("p",null,"Processing...",-1)])])):y("",!0)])}const k=Object.assign(S(I,[["render",Q],["__scopeId","data-v-fe7d0845"]]),{__name:"SessionManager"}),K={name:"AccountSecurityView",components:{SessionManager:k},data(){return{sessionStats:{sessionCount:0,uniqueIPs:0,uniqueLocations:0,lastActivity:"Loading..."}}},async mounted(){await this.loadSessionStats(),h.startActivityMonitoring()},methods:{async loadSessionStats(){try{const[n,s]=await Promise.all([h.getActiveSessions(),h.checkSecurity()]);if(n.success){this.sessionStats.sessionCount=n.totalCount;const t=[...new Set(n.tokens.map(i=>i.location).filter(i=>i&&i!=="Unknown, Unknown"&&i!==", "))].length;this.sessionStats.uniqueLocations=t;const o=n.tokens.find(i=>i.isCurrent);if(o){const i=h.formatSessionInfo(o);this.sessionStats.lastActivity=i.lastActivityFormatted}else if(n.tokens.length>0){const i=n.tokens[0],a=h.formatSessionInfo(i);this.sessionStats.lastActivity=a.lastActivityFormatted}}s.success&&(this.sessionStats.uniqueIPs=s.uniqueIPs)}catch{}}}},X={class:"account-view"},Y={class:"container"},Z={class:"tab-navigation"},ss={class:"tab-content security-section"},ts={class:"security-overview"},es={class:"security-card"},is={class:"card-header"},ns={key:0,class:"warning-badge"},os={key:1,class:"success-badge"},rs={class:"card-content"},as={class:"stats"},cs={class:"stat"},ls={class:"stat-value"},us={class:"stat"},ds={class:"stat-value"},fs={class:"stat"},vs={class:"stat-value"},gs={class:"session-section"};function hs(n,s,t,o,i,a){const r=b("router-link"),m=k;return l(),c("div",X,[e("div",Y,[s[9]||(s[9]=e("div",{class:"header"},[e("h2",null,"Security Settings"),e("p",null,"Manage your account security and active sessions")],-1)),e("div",Z,[d(r,{to:"/account/personal",class:"tab-button"},{default:v(()=>[d(g,{class:"tab-icon"},{default:v(()=>[...s[0]||(s[0]=[u("mdi-account",-1)])]),_:1}),s[1]||(s[1]=u(" Personal ",-1))]),_:1}),d(r,{to:"/account/security",class:"tab-button active"},{default:v(()=>[d(g,{class:"tab-icon"},{default:v(()=>[...s[2]||(s[2]=[u("mdi-shield-lock",-1)])]),_:1}),s[3]||(s[3]=u(" Security ",-1))]),_:1})]),e("div",ss,[e("div",ts,[e("div",es,[e("div",is,[s[4]||(s[4]=e("h3",null,"Session Security",-1)),i.sessionStats.sessionCount>1?(l(),c("span",ns,f(i.sessionStats.sessionCount)+" Active Sessions ",1)):(l(),c("span",os,"Secure"))]),e("div",rs,[s[8]||(s[8]=e("p",null,"Manage your active login sessions and monitor security.",-1)),e("div",as,[e("div",cs,[e("span",ls,f(i.sessionStats.sessionCount),1),s[5]||(s[5]=e("span",{class:"stat-label"},"Active Sessions",-1))]),e("div",us,[e("span",ds,f(i.sessionStats.uniqueLocations),1),s[6]||(s[6]=e("span",{class:"stat-label"},"Unique Locations",-1))]),e("div",fs,[e("span",vs,f(i.sessionStats.lastActivity),1),s[7]||(s[7]=e("span",{class:"stat-label"},"Last Activity",-1))])])])])]),e("div",gs,[d(m)])])])])}const ps=S(K,[["render",hs],["__scopeId","data-v-19487055"]]);export{ps as default};
