import{m as c}from"./B4Kh-yHs.js";const l=void 0,i=async()=>{try{const t=await fetch(`${l}/api/auth/tokens/access`,{method:"GET",credentials:"include"});if(t.ok)return{success:!0};if(t.status===401)try{const s=await t.json();if(s.error==="TOKEN_REVOKED"||s.error==="TOKEN_INVALID"){const{clearAllCaches:r}=c();return r(),{success:!1,tokenRevoked:!0,message:s.message||"Your session has been terminated. Please sign in again."}}}catch{}return{success:!1,tokenRevoked:!1}}catch{return{success:!1,tokenRevoked:!1}}},a=async(t,s={},r=0)=>{const o={...s,credentials:s.credentials||"include"};try{const e=await fetch(t,o);if(e.ok||e.status!==401)return e;if(e.status===401&&r===0){const n=await i();return n.success?await a(t,s,1):(n.tokenRevoked&&window.dispatchEvent(new CustomEvent("token-revoked",{detail:{message:n.message}})),e)}return e}catch(e){throw e}},d=async(t,s={})=>{const r=await a(t,s);let o=null;try{const e=r.headers.get("content-type");if(e&&e.includes("application/json"))o=await r.json();else{const n=await r.text();if(n)try{o=JSON.parse(n)}catch{o={message:n}}}}catch(e){o={error:"Failed to parse response",details:e.message}}return{ok:r.ok,status:r.status,statusText:r.statusText,data:o}};export{d as f};
