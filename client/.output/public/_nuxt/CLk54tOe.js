import{_ as ie,l as re,q as ue,V as de,Q as me,s as ce,t as fe,x as h,R as ve,L as ge,S as pe,T as R,U as ye,W as O,y as C,z as _,B as P,M as D,v as m,N as j,X as S,Y as Ve,Z as be,C as we}from"./B4Kh-yHs.js";import{U as Te}from"./DMqj_JSB.js";import{r as s,f as g,R as ke,Q as he,V as z,I as t,ai as Ce,S as _e,ah as n,J as c,a0 as o,_ as f}from"./CGnq_Kza.js";import"./CjwIl2eS.js";const Pe={class:"admin-view"},$e={class:"text-h4 mb-4"},Ae={class:"text-caption"},Ue={class:"text-center mt-4"},Ee={class:"text-center mt-4"},xe={class:"text-caption text-grey"},Re={class:"text-center mt-4"},Oe={class:"mb-3"},De={__name:"admin",setup(Se){const F=re(),B=ue(),I=s({userId:"",username:"",email:""}),L=s(!1),d=s(!0),r=s(!1),y=s("teams"),$=s(1),A=s(1),U=s(1),u=s(10),V=s([]),b=s([]),w=s([]),T=s(!1),k=s({}),p=s(!1),E=s({}),v=s(""),G=g(()=>{const l=($.value-1)*u.value,e=l+u.value;return V.value.slice(l,e)}),W=g(()=>{const l=(A.value-1)*u.value,e=l+u.value;return b.value.slice(l,e)}),J=g(()=>{const l=(U.value-1)*u.value,e=l+u.value;return w.value.slice(l,e)}),Q=g(()=>Math.ceil(V.value.length/u.value)),q=g(()=>Math.ceil(b.value.length/u.value)),X=g(()=>Math.ceil(w.value.length/u.value));ke(async()=>{const l=await F.getUserByAccessToken();if(!l||l.username!=="admin"){B.push("/home");return}I.value=l,L.value=!0,await Y()});const Y=async()=>{d.value=!0;try{await Promise.all([M(),N(),x()])}catch{}finally{d.value=!1}},M=async()=>{try{const e=await fetch("undefined/api/admin/teams",{method:"GET",credentials:"include"});if(e.ok){const a=await e.json();V.value=a.teams||[]}}catch{}},N=async()=>{try{const e=await fetch("undefined/api/admin/users",{method:"GET",credentials:"include"});if(e.ok){const a=await e.json();b.value=a.users||[]}else{const a=await e.json();alert(`Failed to load users: ${a.message}`)}}catch{}},x=async()=>{try{const e=await fetch("undefined/api/admin/announcements",{method:"GET",credentials:"include",headers:{"Cache-Control":"no-cache"}});if(e.ok){const a=await e.json();w.value=(a.announcements||[]).sort((i,oe)=>new Date(oe.createdAt)-new Date(i.createdAt))}}catch{}},Z=l=>{B.push(`/teams/${l._id}`)},H=async l=>{if(confirm(`Are you sure you want to delete team "${l.name}"? This will delete all associated data including tasks, announcements, and memberships.`)){r.value=!0;try{const a=await fetch(`undefined/api/admin/teams/${l._id}`,{method:"DELETE",credentials:"include"});if(a.ok)await M();else{const i=await a.json();alert(`Failed to delete team: ${i.message}`)}}catch{alert("Failed to delete team")}finally{r.value=!1}}},K=l=>{E.value=l,v.value="",p.value=!0},ee=async()=>{if(v.value.trim())try{const e=await fetch("undefined/api/admin/notify",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({userId:E.value._id,message:v.value,type:"admin"})});if(e.ok)p.value=!1,v.value="";else{const a=await e.json();alert(`Failed to send notification: ${a.message}`)}}catch{alert("Failed to send notification")}},ae=async l=>{if(confirm(`Are you sure you want to delete user "${l.username}"? This will delete all their data including tasks, submissions, and comments.`)){r.value=!0;try{const a=await fetch(`undefined/api/admin/users/${l._id}`,{method:"DELETE",credentials:"include"});if(a.ok)await N();else{const i=await a.json();alert(`Failed to delete user: ${i.message}`)}}catch{alert("Failed to delete user")}finally{r.value=!1}}},te=l=>{k.value=l,T.value=!0},le=async l=>{if(confirm(`Are you sure you want to delete announcement "${l.title}"?`)){r.value=!0;try{const a=await fetch(`undefined/api/admin/announcements/${l._id}`,{method:"DELETE",credentials:"include"});if(a.ok)await x();else{const i=await a.json();alert(`Failed to delete announcement: ${i.message}`)}}catch{alert("Failed to delete announcement")}finally{r.value=!1}}},ne=async()=>{setTimeout(async()=>{T.value=!1,await x()},1250)},se=l=>l.fullBreadcrumbs&&l.fullBreadcrumbs.trim()?l.fullBreadcrumbs.replace(/\s*>\s*$/,"")+" > "+l.name:l.name;return(l,e)=>(z(),he("div",Pe,[t(de,{fluid:""},{default:n(()=>[t(ce,null,{default:n(()=>[t(fe,{cols:"12"},{default:n(()=>[c("h1",$e,[t(h,{class:"mr-2"},{default:n(()=>[...e[10]||(e[10]=[o("mdi-shield-crown",-1)])]),_:1}),e[11]||(e[11]=o(" Admin Panel ",-1))]),t(ve,{modelValue:d.value,"onUpdate:modelValue":e[0]||(e[0]=a=>d.value=a),class:"align-center justify-center"},{default:n(()=>[t(ge,{indeterminate:"",size:"64"})]),_:1},8,["modelValue"]),t(pe,{modelValue:y.value,"onUpdate:modelValue":e[1]||(e[1]=a=>y.value=a),class:"mb-4"},{default:n(()=>[t(R,{value:"teams"},{default:n(()=>[t(h,{class:"mr-2"},{default:n(()=>[...e[12]||(e[12]=[o("mdi-briefcase-variant",-1)])]),_:1}),o(" Teams ("+f(V.value.length)+") ",1)]),_:1}),t(R,{value:"users"},{default:n(()=>[t(h,{class:"mr-2"},{default:n(()=>[...e[13]||(e[13]=[o("mdi-account-group",-1)])]),_:1}),o(" Users ("+f(b.value.length)+") ",1)]),_:1}),t(R,{value:"announcements"},{default:n(()=>[t(h,{class:"mr-2"},{default:n(()=>[...e[14]||(e[14]=[o("mdi-bullhorn",-1)])]),_:1}),o(" Announcements ("+f(w.value.length)+") ",1)]),_:1})]),_:1},8,["modelValue"]),t(ye,{modelValue:y.value,"onUpdate:modelValue":e[5]||(e[5]=a=>y.value=a)},{default:n(()=>[t(O,{value:"teams"},{default:n(()=>[t(C,null,{default:n(()=>[t(_,null,{default:n(()=>[...e[15]||(e[15]=[o("Team Management",-1)])]),_:1}),t(P,null,{default:n(()=>[t(D,{headers:[{title:"Team Name",key:"name",width:"25%"},{title:"Breadcrumbs",key:"breadcrumbs",width:"35%"},{title:"Members",key:"memberCount",width:"10%"},{title:"Tasks",key:"taskCount",width:"10%"},{title:"Actions",key:"actions",sortable:!1,width:"20%"}],items:G.value,loading:d.value,"item-value":"_id","hide-default-footer":""},{"item.breadcrumbs":n(({item:a})=>[c("span",Ae,f(se(a)),1)]),"item.memberCount":n(({item:a})=>[t(j,{color:"primary",size:"small"},{default:n(()=>[o(f(a.memberCount||0),1)]),_:2},1024)]),"item.taskCount":n(({item:a})=>[t(j,{color:"success",size:"small"},{default:n(()=>[o(f(a.taskCount||0),1)]),_:2},1024)]),"item.actions":n(({item:a})=>[t(m,{icon:"mdi-pencil",size:"small",color:"primary",onClick:i=>Z(a),class:"mr-2"},null,8,["onClick"]),t(m,{icon:"mdi-delete",size:"small",color:"error",onClick:i=>H(a),loading:r.value},null,8,["onClick","loading"])]),_:1},8,["items","loading"]),c("div",Ue,[t(S,{modelValue:$.value,"onUpdate:modelValue":e[2]||(e[2]=a=>$.value=a),length:Q.value,"total-visible":7},null,8,["modelValue","length"])])]),_:1})]),_:1})]),_:1}),t(O,{value:"users"},{default:n(()=>[t(C,null,{default:n(()=>[t(_,null,{default:n(()=>[...e[16]||(e[16]=[o("User Management",-1)])]),_:1}),t(P,null,{default:n(()=>[t(D,{headers:[{title:"Username",key:"username"},{title:"Email",key:"email"},{title:"Actions",key:"actions",sortable:!1}],items:W.value,loading:d.value,"item-value":"userId","hide-default-footer":""},{"item.actions":n(({item:a})=>[t(m,{icon:"mdi-bell",size:"small",color:"warning",onClick:i=>K(a),class:"mr-2"},null,8,["onClick"]),t(m,{icon:"mdi-delete",size:"small",color:"error",onClick:i=>ae(a),loading:r.value,disabled:a.username==="admin"},null,8,["onClick","loading","disabled"])]),_:1},8,["items","loading"]),c("div",Ee,[t(S,{modelValue:A.value,"onUpdate:modelValue":e[3]||(e[3]=a=>A.value=a),length:q.value,"total-visible":7},null,8,["modelValue","length"])])]),_:1})]),_:1})]),_:1}),t(O,{value:"announcements"},{default:n(()=>[t(C,null,{default:n(()=>[t(_,null,{default:n(()=>[...e[17]||(e[17]=[o("Announcement Management",-1)])]),_:1}),t(P,null,{default:n(()=>[t(D,{headers:[{title:"Title",key:"title",width:"30%"},{title:"Subtitle",key:"subtitle",width:"25%"},{title:"Author",key:"createdByUsername",width:"25%"},{title:"Actions",key:"actions",sortable:!1,width:"20%"}],items:J.value,loading:d.value,"item-value":"_id","hide-default-footer":""},{"item.subtitle":n(({item:a})=>[c("span",xe,f(a.subtitle||"(No subtitle)"),1)]),"item.actions":n(({item:a})=>[t(m,{icon:"mdi-pencil",size:"small",color:"primary",onClick:i=>te(a),class:"mr-2"},null,8,["onClick"]),t(m,{icon:"mdi-delete",size:"small",color:"error",onClick:i=>le(a),loading:r.value},null,8,["onClick","loading"])]),_:1},8,["items","loading"]),c("div",Re,[t(S,{modelValue:U.value,"onUpdate:modelValue":e[4]||(e[4]=a=>U.value=a),length:X.value,"total-visible":7},null,8,["modelValue","length"])])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(me,{modelValue:p.value,"onUpdate:modelValue":e[8]||(e[8]=a=>p.value=a),"max-width":"500px"},{default:n(()=>[t(C,null,{default:n(()=>[t(_,null,{default:n(()=>[...e[18]||(e[18]=[o("Send Notification",-1)])]),_:1}),t(P,null,{default:n(()=>[c("p",Oe,[e[19]||(e[19]=o(" Send a notification to ",-1)),c("strong",null,f(E.value.username),1)]),t(Ve,{modelValue:v.value,"onUpdate:modelValue":e[6]||(e[6]=a=>v.value=a),label:"Message",variant:"outlined",rows:"4",counter:"500",maxlength:"500"},null,8,["modelValue"])]),_:1}),t(be,null,{default:n(()=>[t(we),t(m,{onClick:e[7]||(e[7]=a=>p.value=!1)},{default:n(()=>[...e[20]||(e[20]=[o("Cancel",-1)])]),_:1}),t(m,{color:"primary",onClick:ee,disabled:!v.value.trim()},{default:n(()=>[...e[21]||(e[21]=[o(" Send Notification ",-1)])]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),d.value===!1&&k.value._id?(z(),Ce(Te,{key:0,dialog:T.value,"onUpdate:dialog":e[9]||(e[9]=a=>T.value=a),announcement:k.value,teamId:k.value.teamId,"user-props":I.value,onAnnouncementUpdated:ne},null,8,["dialog","announcement","teamId","user-props"])):_e("",!0)]))}},je=ie(De,[["__scopeId","data-v-8ddeb14a"]]);export{je as default};
